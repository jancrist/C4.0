<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva Exitosa! - Vuela Tunel De Viento</title>
    <link rel="icon" href="static/logo_naranja.png" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas2image/0.1.0/canvas2image.min.js"></script>
    <!-- Incluye la librer√≠a dom-to-image para capturar el contenido como imagen -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

    <style>
        /* Estilos para el fondo blanco */
        body {
            background-color: #f4f4f4; /* Fondo gris claro */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif; /* Fuente elegante */
        }

        /* Contenedor principal */
        .container {
            display: flex;
            justify-content: space-between; /* Colocar tarjetas en lados opuestos */
            max-width: 900px; /* Ancho m√°ximo del contenedor */
            width: 100%; /* Asegurar ancho total en dispositivos peque√±os */
        }

        /* Estilos para la tarjeta izquierda */
        .left-card {
            background-color: #e9e9e9; /* Fondo blanco */
            max-width: 450px;
            padding: 50px;
            border-radius: 10px;
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2); /* Sombras m√°s pronunciadas */
            text-align: center; /* Alineaci√≥n a la izquierda del texto */
            flex: 1; /* Ocupar el espacio restante en el contenedor */
            margin-right: 50px;
            
            display: flex; /* Activa el uso de flexbox para alinear verticalmente */
            flex-direction: column; /* Apila los elementos verticalmente */
            justify-content: center; /* Alinea verticalmente al centro */
            align-items: center; 
        }

        /* Estilos para la tarjeta derecha */
        .right-card {
            background-color: #fff; /* Fondo blanco */
            max-width: 450px;
            
            border-radius: 10px;
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2); /* Sombras m√°s pronunciadas */
            text-align: left;
            flex: 1; /* Ocupar el espacio restante en el contenedor */
            
        }

        /* Estilos para el logotipo */
        .logo {
            width: 150px; /* Tama√±o del logotipo */
            height: 150px;
            margin-bottom: 20px;
        }

        /* Estilos para el t√≠tulo */
        h1 {
            color: #FFA500; /* Texto naranja */
            font-size: 24px; /* Tama√±o de fuente m√°s grande */
            margin-bottom: 10px; /* Margen inferior reducido */
        }
/* Estilos para el t√≠tulo */
h2 {
            color: rgb(255, 255, 255); /* Texto naranja */
            font-size: 24px; /* Tama√±o de fuente m√°s grande */
            margin-bottom: 20px; /* Margen inferior reducido */
        }
        /* Estilos para los datos de la reserva */
        p {
            font-size: 18px; /* Tama√±o de fuente un poco m√°s grande */
            margin: 15px 0; /* Margen superior e inferior */
        }

        /* Estilos para los campos en negrita */
        strong {
            font-weight: bold; /* Texto en negrita */
        }

        /* Estilos para el c√≥digo QR */
        .qr-code {
            margin-top: 20px;
            display: flex;
            justify-content: center; /* Centrar horizontalmente */
            margin-bottom: 50px;
            
        }

        /* Estilos para el c√≥digo QR */
        canvas {
            width: 250px;
            height: 250px;
        }

        /* Estilos para la lista de elementos en la tarjeta izquierda */
        ul {
            list-style-type: none;
            padding: 0;
        }

        /* Estilos para los elementos de la lista en la tarjeta izquierda */
        li {
            margin-bottom: 10px;
        }

        /* Estilos para los botones */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .button {
            background-color: #999999;
            color: #fff;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            cursor: pointer;
        }
        .logo2 {
            width: 130px; /* Tama√±o del logo */
            height: 100px; /* Tama√±o del logo */
            margin-bottom: 10px; /* Margen inferior */
        }
        .whatsapp-button {
                padding: 10px 15px;
                font-size: 14px;
                margin-top: 10px;
            }
        .button:hover {
            background-color: #FF8000;
        }
        /* Estilos para hacerlo responsive en pantallas peque√±as */
        @media screen and (max-width: 600px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            .left-card {
                margin-top: 20px;
                margin-right: 0;
                margin-bottom: 20px;
            }
            .right-card {
                margin-top: 20px;
                margin-bottom: 20px;
                margin-right: 0;
            }
            .whatsapp-button {
                padding: 10px 15px;
                font-size: 14px;
                
            }
        }
        /* Estilos para el mensaje de env√≠o del comprobante */
        .share-button {
            font-size: 14px; /* Tama√±o de fuente peque√±o */
            color: rgb(255, 91, 3); /* Color gris claro (#999 es un ejemplo, puedes ajustar el valor de color seg√∫n tus preferencias) */
            margin-top: 10px; /* Espacio superior para separarlo de los datos de la reserva */
            
    margin-left: 50px; /* Ajusta el valor seg√∫n la separaci√≥n deseada */

        }




        
/* Estilo para la parte superior */
.right-card .parte_arriba {
    position: center;
    width: 100%;
    height:40px; /* Ajusta la altura seg√∫n tus necesidades */
    margin-bottom: 20px;
    margin-top: 40px;
    background: linear-gradient(to left, rgb(255, 125, 3), rgba(0, 234, 255, 0.595)), url('{{ url_for("static", filename="fondo_cuadrado_label.png") }}') center center / cover no-repeat; /* Fondo de degradado y ruta de la imagen */
    text-align: center;
    color: #fff; /* Color del texto */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Estilo para el texto en la parte superior */
.right-card .parte_arriba h2 {
    margin: 0;
    font-size: 18px; /* Ajusta el tama√±o del texto seg√∫n tus necesidades */
}

.central {
            max-width: 400px;
            margin: 0 auto;
            margin-left: -20px;
            padding: 30px;
            
            
        }
       .left-card h2 {
            color: rgb(255, 91, 3); /* Texto naranja */
            font-size: 24px; /* Tama√±o de fuente m√°s grande */
            margin-bottom: 20px; /* Margen inferior reducido */
        }


        /* Agrega estilos espec√≠ficos para el p√°rrafo dentro de left-card */
.left-card .orange-text {
    color:  rgb(255, 91, 3); /* Cambia "orange" por el color naranja deseado */
    /* Otros estilos seg√∫n tus necesidades */
}

.central p {
    margin-left: 50px; /* Ajusta el valor seg√∫n la separaci√≥n deseada */
    color: #5d5d5d;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="left-card">
            <img src="static/calendario.png" alt="Logotipo" class="logo">
            
            <h2>¬°RESERVA EXITOSA!</h2>
            
            <p class="orange-text">Los esperamos para volar!</p>
            <p>Record√° que los valores son los publicados en vuela.com.ar al momento de la visita. Estos pueden variar sin previo aviso.</p>
            
         
            
            
            <p>Queres pagar ahora?</p>
            <div class="button-container">
                
                <button class="button" id="btn-pagar-ahora" onclick="window.location.href='https://www.vuela.com.ar/preparate-para-volar.php?#tarifas'">Pagar ahora</button>

            </div>
        </div>
        <div class="right-card">
            <!-- Logotipo -->
            
            
            <!-- T√≠tulo -->
            <div class="parte_arriba">

                <h2>COMPROBANTE DE RESERVA</h2>
    
               </div>
               <div class="central">
            <div class="qr-code" id="qr-code"></div>
            <!-- Datos de la reserva -->
            <p><strong>Nombre:</strong> <span id="nombre"></span></p>
            <p><strong>Fecha:</strong> <span id="fecha"></span></p>
            <p><strong>Horario:</strong> <span id="horario"></span></p>
            <p><strong>Cantidad:</strong> <span id="cantidad"></span></p>
            <p><strong>DNI:</strong><span id="dni"></span></p>
            <p><strong>Tel√©fono:</strong> <span id="telefono"></span></p>
            <p><strong>Email:</strong> <span id="email"></span></p>
            
            <!-- C√≥digo QR -->
            
            <!-- Bot√≥n de compartir por WhatsApp -->
            <div class="share-button">
                Hemos enviado tu reserva por email y por Whatsapp!
            </div>
        </div>

        </div>
    </div>

    <!-- Incluye la librer√≠a QRCode.js para generar el c√≥digo QR en el DOM -->
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/0.9.1/html2image.min.js"></script>

    
<script>
    // Funci√≥n para convertir de hexadecimal a cadena
function fromHex(hex) {
  let str = '';
  for (let i = 0; i < hex.length; i += 2) {
    str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
  }
  return str;
}
    // Encuentra el elemento right-card por su clase
const rightCard = document.querySelector('.right-card');

// Agrega un evento para escuchar cuando se genera el comprobante
document.addEventListener('DOMContentLoaded', () => {
    // Llama a la funci√≥n para capturar la imagen cuando se cargue la p√°gina
    captureRightCard();
});

// Funci√≥n para capturar el contenido de right-card y guardar como imagen
function captureRightCard() {
    // Usa dom-to-image para capturar la imagen del elemento right-card
    domtoimage.toPng(rightCard)
        .then(function (dataUrl) {
            // Crea un elemento <a> para descargar la imagen
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'comprobante.png'; // Nombre del archivo a descargar

            // Agrega el enlace al cuerpo del documento y haz clic autom√°ticamente para descargar la imagen
            document.body.appendChild(link);
            link.click();

            // Elimina el enlace del cuerpo del documento
            document.body.removeChild(link);

            // Obt√©n el destinatario desde donde sea que lo est√©s almacenando en tu c√≥digo
            const destinatario = obtenerDestinatario(); // Aseg√∫rate de implementar esta funci√≥n seg√∫n tu l√≥gica

            // Llama a la funci√≥n para enviar la imagen por correo
            sendImageToServer(dataUrl, destinatario);
        })
        .catch(function (error) {
            console.error('Error al capturar la imagen:', error);
        });
}

// Funci√≥n para enviar la imagen al servidor
function sendImageToServer(imageDataUrl, destinatario) {
    // Convierte la imagen a formato base64 (si no est√° en base64 ya)
    const base64Data = imageDataUrl.split(',')[1];

    // Objeto con los datos del correo y la imagen en base64
    const datosCorreo = {
        to: destinatario,
        asunto: 'Reserva Exitosa! Vuela - Tunel de viento',
        mensaje: 'Reserva Exitosa! Vuela Tunel de viento\n\n\n\n\n\nüóìÔ∏è Record√° que los valores son los publicados en vuela.com.ar al momento de la visita. Estos pueden variar sin previo aviso. \n\nüëüüëï Asistir con ropa c√≥moda y zapatillas con cordones.\n\n‚ùÑÔ∏èEn √©poca invernal es recomendable traer ropa de abrigo para dejar puesta debajo del traje de vuelo.\n\nüåßÔ∏è Con mal tiempo abrimos igual pero siempre si llueve muy fuerte no es recomendable hacer la actividad, atrasamos o reprogramamos los turnos.\n\nüôèüèª En el caso de no poder asistir te pedimos por favor que nos avises con anticipaci√≥n, ya que nos manejamos con turnos programados.\n\nGracias. üòÅ',
        imagen: base64Data, // Adjunta la imagen generada en base64
    };
    

    // Llama a la funci√≥n para enviar el correo utilizando un fetch
    fetch('/enviar_correo_con_imagen', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(datosCorreo)
    })
    .then(response => {
        if (response.status === 200) {
            console.log("Correo enviado con √©xito:", response);

            // Agrega un mensaje en HTML para indicar que la reserva se ha confirmado
            const mensajeHTML = `<p>¬°Tu reserva se ha confirmado con √©xito y el correo se ha enviado!</p>`;
            const mensajeExitoElement = document.getElementById("mensaje-exito");
            mensajeExitoElement.innerHTML = mensajeHTML;
            mensajeExitoElement.style.display = "block";
        } else {
            // Mostrar la respuesta JSON en el elemento HTML
            return response.json();
        }
    })
    .catch(error => {
        console.error("Error al enviar el correo:", error);
    });
}

// Esta es una funci√≥n ficticia, aseg√∫rate de implementarla seg√∫n tu l√≥gica real
function obtenerDestinatario() {
    // Obt√©n el valor del par√°metro 'email' de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const destinatario1 = decodeURIComponent(urlParams.get('email'));
    const destinatario= fromHex(destinatario1);

    // Devuelve el destinatario obtenido de la URL
    return destinatario;
}


</script>
    <script>
        // Decodificar los valores de fecha, horario, cantidad, nombre,Email de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const fecha = decodeURIComponent(urlParams.get('fecha'));
        const horario = decodeURIComponent(urlParams.get('horario'));
        const cantidad = urlParams.get('cantidad');
        const nombre = decodeURIComponent(urlParams.get('nombre'));
        const dni = decodeURIComponent(urlParams.get('dni'));
        const telefono = decodeURIComponent(urlParams.get('telefono'));
        const email = decodeURIComponent(urlParams.get('email'));

        // Desofuscar los datos
const fechaDesofuscada = fromHex(fecha);
const horarioDesofuscado = fromHex(horario);
const cantidadDesofuscada = fromHex(cantidad);
const nombreDesofuscado = fromHex(nombre);
const dniDesofuscado = fromHex(dni);
const telefonoDesofuscado = fromHex(telefono);
const emailDesofuscado = fromHex(email);
        // Mostrar los valores en los elementos <span>
document.getElementById("fecha").textContent = fechaDesofuscada;
document.getElementById("cantidad").textContent = cantidadDesofuscada;
document.getElementById("horario").textContent = horarioDesofuscado;
document.getElementById("nombre").textContent = nombreDesofuscado;
document.getElementById("dni").textContent = dniDesofuscado;
document.getElementById("telefono").textContent = telefonoDesofuscado;
document.getElementById("email").textContent = emailDesofuscado;
        // Generar el texto para el c√≥digo QR
        const qrText = `${fechaDesofuscada}//${horarioDesofuscado}//${cantidadDesofuscada}//${emailDesofuscado}//${nombreDesofuscado}//${telefonoDesofuscado}//${dniDesofuscado}`;

        // Generar y mostrar el c√≥digo QR utilizando QRCode.js
        const qrCode = new QRCode(document.getElementById("qr-code"), {
            text: qrText,
            width: 150, /* Aumentamos el tama√±o del c√≥digo QR */
            height: 150 /* Aumentamos el tama√±o del c√≥digo QR */
        });
        // Funci√≥n para generar la imagen y compartirla



        
    </script>

 
    
</body>
</html>
