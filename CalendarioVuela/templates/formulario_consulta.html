<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva tu Experiencia! - Vuela Tunel De Viento</title>
    <link rel="icon" href="static/logo_naranja.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+Jnujsl5+z0I5t9z5l6Bd5pMy5J5ACJC/1BA5s5n5Sekftr" crossorigin="anonymous">
    

    <style>
        /* Estilos originales */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: rgba(0, 0, 0, 0.2) url('{{ url_for("static", filename="fondo.png") }}') center center / cover no-repeat; /* Fondo con transparencia */
        }
        h1 {
            text-align: center;
            margin: 20px 0;
        }

        .card {
            max-width: 400px;
            margin: 0 auto;
            margin-top: 50px;
            padding: 00px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
        }

  /* Ajusta el ancho de los campos de entrada y los select */
.card input[type="text"],
.card input[type="number"],
.card input[type="tel"], /* Agregamos el tipo "tel" para el campo de teléfono */
.card input[type="text"][name="fecha_nombre"], /* Añadimos una regla específica para el campo de fecha */

.card button {
    width: 375px; /* Cambia esto a un valor específico, por ejemplo, "300px" o "15rem" */
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #e3e3e3;
    border-radius: 20px;
    
}

.card button {
    
    background-color: #FFA500;
    color: white;
}
        .card input[type="text"]:focus,
        .card input[type="number"]:focus,
        

        .card input[type="text"]:invalid,
        .card input[type="number"]:invalid {
            border-color: #dc3545;
        }

        /* Ajusta el ancho de todos los elementos dentro de la tarjeta en pantallas grandes */



/* Establece los estilos adicionales para todos los elementos <input> dentro de la tarjeta */
.card input {
    width: 375px;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-sizing: border-box;
}
.card button:hover {
    background-color: #0056b3;
}

        #horarios-libres {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        #mensaje-exito {
            text-align: center;
            color: green;
            display: none;
            margin-top: 10px;
        }

        /* Estilos para hacer responsive */
        /* Utiliza Flexbox para que los elementos dentro de la tarjeta tengan el mismo ancho */
        .card form {
            display: flex;
            flex-direction: column;
        }



/* Estilo para el dropdown (select) */
.card select {
    width: 375px;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 20px;
    position: relative;
    appearance: none; /* Oculta la flecha del navegador */
    -webkit-appearance: none; /* Para navegadores basados en WebKit (Chrome, Safari, etc.) */
    -moz-appearance: none; /* Para navegadores basados en Gecko (Firefox) */
}






/* Estilo para el fondo del dropdown */
.card select::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: #fff; /* Color de fondo del dropdown */
    z-index: -1; /* Asegura que el fondo esté detrás del contenido del dropdown */
}

/* Estilo para la flechita del dropdown */
.card select::after {
    content: '\25BC'; /* Carácter de flecha hacia abajo */
    font-size: 1.5em; /* Tamaño de la flecha */
    color: #555; /* Color de la flecha */
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    pointer-events: none; /* Evita que la flecha sea clickeable */
}

/* Estilo cuando el dropdown está enfocado */
.card select:focus::before {
    border-color: #FFA500;
}

/* Estilo cuando el dropdown está desactivado o no seleccionado */
.card select:invalid {
    border-color: #dc3545;
}


/* Agrega una clase específica para el dropdown con icono */
.card .dropdown-icon {
    position: relative;
}

/* Estilo para el dropdown (select) con icono */
.card .dropdown-icon select {
    width: 375px;
    padding: 10px 30px 10px 10px; /* Ajusta el padding para dejar espacio al icono */
    margin-bottom: 10px;
    border: 1px solid #e3e3e3;
    border-radius: 20px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('{{ url_for("static", filename="flecha_abajo.png") }}') ; /* Ruta de tu icono */
    background-position: right 5px center; /* Posición del icono (derecha, centrado verticalmente) */
    background-repeat: no-repeat; /* Evita la repetición del icono */
    background-size: 30px 30px;
    background-color: rgb(206, 206, 206);
}

/* Estilo cuando el dropdown con icono está enfocado */
.card .dropdown-icon select:focus {
    border-color: #FFA500;
}


/*PARTE DE LA FECHA*/

/* Agrega una clase específica para el campo de fecha con icono */
.card .date-input-icon {
    position: relative;
}

/* Estilo para el campo de entrada de fecha con icono */
.card .date-input-icon input {
    width: 375px;
    padding: 10px 30px 10px 10px; /* Ajusta el padding para dejar espacio al icono */
    margin-bottom: 10px;
    border: 1px solid #e3e3e3;
    border-radius: 20px;
    box-sizing: border-box; /* Asegura que el ancho incluye el relleno y el borde */
    background-image: url('{{ url_for("static", filename="flecha_abajo.png") }}'); /* Ruta de tu icono */
    background-position: right 5px center; /* Posición del icono (derecha, centrado verticalmente) */
    background-repeat: no-repeat; /* Evita la repetición del icono */
    background-size: 30px 30px; /* Ajusta el ancho y alto del icono */
    background-color: rgb(206, 206, 206);
}

/* Estilo cuando el campo de fecha con icono está enfocado */
.card .date-input-icon input:focus {
    border-color: #FFA500;
}

/*parte horarios*/
/* Agrega una clase específica para el dropdown de horarios con icono */
.card .schedule-dropdown-icon {
    position: relative;
}

/* Estilo para el dropdown de horarios con icono */
.card .schedule-dropdown-icon select {
    width: 360px;
    
    padding: 10px 15px 10px 10px; /* Ajusta el padding para dejar espacio al icono */
    margin-bottom: 10px;
    border: 1px solid #e3e3e3;
    border-radius: 40px;
    box-sizing: border-box; /* Asegura que el ancho incluye el relleno y el borde */
    background-image: url('{{ url_for("static", filename="flecha_abajo.png") }}'); /* Ruta de tu icono */
    background-position: right 5px center; /* Posición del icono (derecha, centrado verticalmente) */
    background-repeat: no-repeat; /* Evita la repetición del icono */
    background-size: 30px 30px; /* Ajusta el ancho y alto del icono */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-color: rgb(206, 206, 206);
}

/* Estilo cuando el dropdown de horarios con icono está enfocado */
.card .schedule-dropdown-icon select:focus {
    border-color: #FFA500;
}



        @media screen and (max-width: 600px) {
    .card * {
        width: 100%; /* Cambia esto a un valor específico, por ejemplo, "300px" o "15rem" */
        min-width: 400px; /* Establece el ancho mínimo de 400px */
    }

    .central {
            max-width: 400px;
            margin: 0 auto;
            margin-left: -20px;
            padding: 30px;
            
            
        }


    .card input[type="text"],
    .card input[type="number"],
    .card input[type="tel"],
    .card input[type="text"][name="fecha_nombre"],
    .card select {
        width: 100%; /* Cambia esto a un valor específico, por ejemplo, "300px" o "15rem" */
        min-width: 400px; /* Establece el ancho mínimo de 400px */
    }
    .card select::before {
        width: 100%; /* Ocupa todo el ancho del dropdown en pantallas pequeñas */
    }
    .logo {
        width: 100px;
        height: 80px;
    }
}


        /* Estilos para el logo en la tarjeta izquierda */
        .logo {
            width: 130px; /* Tamaño del logo */
            height: 100px; /* Tamaño del logo */
            margin-bottom: 10px; /* Margen inferior */
        }
/* Establece el ancho para el elemento select con el id "horarios-libres" */
#horarios-libres {
    width: 375px; /* Cambia esto a un valor específico, como "300px" o "15rem" */
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 20px;
    box-sizing: border-box; /* Esto asegura que el ancho incluye el relleno y el borde */
}


/* Estilo para el mensaje de reserva */
.reserva-mensaje {
    font-size: 14px;
    color: #FFA500;
    margin-top: 10px;
}



/* Estilo para la parte inferior */
.card .parte_baja {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 100px; /* Ajusta según sea necesario */
}

/* Estilo para el logo a la izquierda */
.card .logo_parte_baja {
    width: 80px; /* Ajusta el ancho del logo según tus necesidades */
    height: auto; /* Permite que la altura se ajuste proporcionalmente */
    margin-right: 20px; /* Ajusta el margen derecho según sea necesario */
    margin-bottom: 30px;
    margin-left: 20px;
}

/* Estilo para el botón de confirmación a la derecha */
.card #btn-confirmar {
    margin-left: auto; /* Empuja el botón hacia la derecha */
    display: block; 
    /* Asegura que el botón sea visible */
    width: 115px; 
    font-size: 16px;  /* Ajusta el tamaño de fuente según tus preferencias */
    padding: 5px 10px; 
    margin-right: 15px;
    background: linear-gradient(to left, rgb(255, 125, 3), rgba(0, 234, 255, 0.595)), url('{{ url_for("static", filename="fondo_cuadrado_label.png") }}') center center / cover no-repeat; /* Fondo de degradado y ruta de la imagen */
}





/* Estilo para la parte superior */
.card .parte_arriba {
    position: center;
    width: 100%;
    height: 30px; /* Ajusta la altura según tus necesidades */
    margin-bottom: 20px;
    margin-top: 40px;
    background: linear-gradient(to left, rgb(255, 125, 3), rgba(0, 234, 255, 0.595)), url('{{ url_for("static", filename="fondo_cuadrado_label.png") }}') center center / cover no-repeat; /* Fondo de degradado y ruta de la imagen */
    text-align: center;
    color: #fff; /* Color del texto */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Estilo para el texto en la parte superior */
.card .parte_arriba h2 {
    margin: 0;
    font-size: 18px; /* Ajusta el tamaño del texto según tus necesidades */
}


.central {
            max-width: 400px;
            margin: 0 auto;
            margin-left: -20px;
            padding: 30px;
            
            
        }

        .advertencia_baja{
            margin-top: 20px;
            margin-bottom: 20px;
            color: #555;
            font-size: 10px;
            position: center;
            text-align: center;
            display: flex;
    align-items: center;
    justify-content: center;
        }
    </style>
</head>
<body>

    <div class="card">
        <form id="consulta-form">
            
           <div class="parte_arriba">

            <h2>Reserva tu visita</h2>

           </div>
           <input type="hidden" id="nombre" name="nombre" required class="form-select">
            <input type="hidden" id="telefono" name="telefono" required class="form-select">
           <div class="central">
            <label for="cantidad">Cantidad de Participantes:</label>

            <div class="input-group dropdown-icon">
                <select id="cantidad" name="cantidad" class="form-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
            </div>

            <!-- Agrega el mensaje para reservas de 7 participantes o más -->
            <p class="reserva-mensaje">Para reservas de 7 participantes o más, envíanos un mensaje</p>

            <div class="date-input-icon">
                <label for="fecha">Fecha Disponible</label>
                <input type="date" id="fecha" name="fecha_nombre" required class="form-control">
            </div>
        </form>

        <div class="schedule-dropdown-icon">
            <!-- Horarios disponibles -->
            <h3 id="horarios-titulo" >Horarios</h3>
            <select id="horarios-libres" class="form-select"></select>
        </div>
        <div class="parte_baja">
            <img src="static/logo_tunel2.png" alt="Logo" class="logo_parte_baja">
            <!-- Botón de confirmación -->
            <button type="button" id="btn-confirmar" class="btn btn-primary" onclick="redirigirAFormularioConsultaDatos()" >Siguiente</button>

        </div>
        <!-- Mensaje de éxito (inicialmente oculto) -->
        <p id="mensaje-exito" style="display:none;">Cliente creado con éxito.</p>
    </div>
    
        
    </div>
    <label class="advertencia_baja">Por favor, lee cuidadosamente los datos ingresados</label>
   <script>
    
        // Asociar la función a los cambios en el datepicker
        document.getElementById('fecha').addEventListener('change', function () {
            // Ejecutar consultarHorariosLibres al cambiar la fecha
            consultarHorariosLibres();
            mostrarHorariosDisponibles();
        });

        // Función de ejemplo consultarHorariosLibres
        function consultarHorariosLibres() {
            console.log("Consultando horarios libres...");
            // Lógica para consultar horarios libres
        }
   </script>
    
    <script>
        // Inicializar flatpickr para seleccionar horas
        flatpickr("#hora", {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
        });

        // Resto del código JavaScript aquí
    </script>
    <script>
        let cantidad = 1; // Valor inicial
    
        function sumarCantidad() {
            if (cantidad < 6) { // Verifica el límite máximo de 6 participantes
                cantidad++;
                actualizarCantidad();
            }
        }
    
        function restarCantidad() {
            if (cantidad > 1) { // Verifica el límite mínimo de 1 participante
                cantidad--;
                actualizarCantidad();
            }
        }
    
        function actualizarCantidad() {
            document.getElementById("cantidad").value = cantidad;
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Función para cargar las fechas disponibles desde la API

        function redirigirAFormularioConsultaDatos() {
    const cantidad = encodeURIComponent(document.getElementById("cantidad").value);
    const fecha = encodeURIComponent(document.getElementById("fecha").value);
    const horario = encodeURIComponent(document.getElementById("horarios-libres").value);

    // Realiza la solicitud para crear el token
    fetch('/api/tokens', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ fecha, horario, cantidad })
    })
    .then(response => response.json())
    .then(data => {
        // Obtiene el token generado
        const token = data.id; // Suponemos que el id es el token generado

        // Redirige a la página con los datos y el token
        const url = `/formulario_consulta_datos?fecha=${fecha}&horario=${horario}&cantidad=${cantidad}&token=${token}`;
        window.location.href = url;
    })
    .catch(error => console.error('Error:', error));
}
        function cargarFechasDisponibles() {
            fetch('/api/fechas', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                const selectFecha = document.getElementById('fecha');
                selectFecha.innerHTML = ''; // Limpiar resultados anteriores

                // Filtrar las fechas disponibles con estado 'Abierto'
                const fechasAbiertas = data.filter(fecha => fecha.status === 'Abierto');

                // Crear un arreglo de fechas habilitadas en el formato "AAAA-MM-DD"
                const fechasHabilitadas = fechasAbiertas.map(fechaDisponible => fechaDisponible.fecha);

                // Inicializar flatpickr con las fechas habilitadas
                flatpickr("#fecha", {
    dateFormat: "Y-m-d",
    minDate: "today",
    enable: fechasHabilitadas,
    locale: {
        firstDayOfWeek: 1, // Lunes como primer día de la semana
        weekdays: {
            shorthand: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
            longhand: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
        },
        months: {
            shorthand: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            longhand: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
        },
    },
});

                fechasAbiertas.forEach(fechaDisponible => {
                    const option = document.createElement('option');
                    option.value = fechaDisponible.fecha;
                    option.text = fechaDisponible.fecha;
                    selectFecha.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error al obtener las fechas:', error);
            });
        }

        // Función para consultar horarios libres
        function consultarHorariosLibres() {
            const nombre = document.getElementById("nombre").value;
            const telefono = document.getElementById("telefono").value;
            const cantidad = document.getElementById("cantidad").value;
            const fechaNombre = document.getElementById("fecha").value; // Usamos el valor de fecha como fecha_nombre

            // Llamada a la API para obtener horarios libres según la fecha y cantidad
            fetch(`/api/clientes/resta_cantidad/${fechaNombre}`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                const horariosLibres = document.getElementById("horarios-libres");
                horariosLibres.innerHTML = ''; // Limpiar resultados anteriores

                for (const horario in data) {
                    if (data[horario][fechaNombre] >= cantidad || data[horario]["Disponible"] >= cantidad) {
                        const option = document.createElement("option");
                        option.value = horario;
                        option.textContent = horario;
                        horariosLibres.appendChild(option);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        

        // Llama a la función para cargar las fechas disponibles al cargar la página
        window.addEventListener('load', cargarFechasDisponibles);
    </script>
</body>
</html>